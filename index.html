<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Benchmark Performance</title>
		<script type="text/javascript" src="d3.v3.js"></script>
		<style type="text/css">
            .axis path,
            .axis line {
                    fill: none;
                    stroke: grey;
                    shape-rendering: crispEdges;
            }

            .axis text {
                    font-family: sans-serif;
                    font-size: 11px;
            }
		</style>
	</head>
	<body>
		<script type="text/javascript">

            function arrays_equal(a,b) { return !(a<b || b<a); }
			
			var w = 800;
			var h = 400;
            var axis_h = 20;
            var axis_w = 20;
			var intrabar_padding = 0;
            var interbar_padding = 3;

            //benchmark = set of bars
            //method = one bar in each set
            //time = y axis (normalized)
            var benchmark = d3.scale.ordinal()
            var time = d3.scale.linear()
                        .range([h, 0])

			var svg = d3.select("body")
						.append("svg")
						.attr("width", w+axis_w)
						.attr("height", h+axis_h);
            var plot = svg.append("g")
                        .attr("transform", "translate("+String(axis_w)+",0)")

            var baseline = 0;

            d3.json("data.json", function(err, parsed) {
                    var methods = parsed.methods;
                    var benchmarks = parsed.benchmarks;
                    benchmark.domain(benchmarks.map(function (a) { return a[0]; }));
                    benchmark.rangeRoundBands([0,w],0.3,0.1)
                    time.domain([0, 10]) // TODO make more general
                    var bar_width = benchmark.rangeBand() / 3;

                    var entering = plot.selectAll("rect")
                                    .data(benchmarks)
                                    .enter()

                    entering.append("rect")
                       .attr("x", function(d) {
                            console.log(d[0])
                            console.log(benchmark(d[0]));
                            return benchmark(d[0]);
                       })
                       .attr("y", function(d) {
                            return time(+(d[1][1]))
                       })
                       .attr("width", bar_width)
                       .attr("height", function(d){
                            return h - time(+(d[1][1]))
                       })
                       .attr("fill", "green");


                    entering.append("rect")
                       .attr("x", function(d) {
                            return benchmark(d[0]) + bar_width;
                       })
                       .attr("y", function(d) {
                            return time(+(d[1][2]))
                       })
                       .attr("width", bar_width)
                       .attr("height", function(d){
                            return h - time(+(d[1][2]))
                       })
                       .attr("fill", "blue");


                    entering.append("rect")
                       .attr("x", function(d) {
                            return benchmark(d[0]) + 2*bar_width;
                       })
                       .attr("y", function(d) {
                            return time(+(d[1][3]))
                       })
                       .attr("width", bar_width)
                       .attr("height", function(d){
                            return h - time(+(d[1][3]))
                       })
                       .attr("fill", "purple");


                });

		</script>
	</body>
</html>
